package ru.easydonate.exploitfix;

import org.bukkit.plugin.java.JavaPlugin;
import ru.easydonate.exploitfix.listener.ProtocolChatPacketListener;
import ru.easydonate.exploitfix.patcher.LoggerPatcher;

import java.util.regex.Pattern;

public final class ExploitFixPlugin extends JavaPlugin {
    
    private static final Pattern DETECTOR_PATTERN = Pattern.compile("\\{*jndi:.*}");
    
    @Override
    public void onLoad() {
        boolean hasPatched = new LoggerPatcher(this, DETECTOR_PATTERN).patch();
        if(!hasPatched)
            getServer().getPluginManager().disablePlugin(this);
    }
    
    @Override
    public void onEnable() {
        new ProtocolChatPacketListener(this, DETECTOR_PATTERN);

        getLogger().info("Exploit protection has been enabled!");
    }

}
